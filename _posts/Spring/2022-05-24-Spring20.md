---
title: "[SpringBoot] ìŠ¤í”„ë§ë¶€íŠ¸ + JPAë¥¼ ì´ìš©í•œ CRUD êµ¬í˜„ 4. ë¦¬ìŠ¤íŠ¸ ì¶œë ¥í•˜ê¸°"
author: Jinsol
categories: SpringBoot
tags: SpringBoot
date: '2022-05-24'
image: /assets/img/springLogo.png
---

<br>

## <span style="color:#809A6F">ğŸ‹ JPA Auditing</span>
<hr>

src/main/java/com/test/spring/boot_crud/domain/BaseTimeEntity.java

```java
package com.test.spring.boot_crud.domain;

import lombok.Getter;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.LastModifiedDate;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

import javax.persistence.EntityListeners;
import javax.persistence.MappedSuperclass;
import java.time.LocalDateTime;

@Getter
@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public class BaseTimeEntity {

    @CreatedDate
    private LocalDateTime createdDate;

    @LastModifiedDate
    private LocalDateTime modifiedDate;
}
```

<br>

Posts í´ë˜ìŠ¤ë„ ìˆ˜ì •í•´ì£¼ì.

```java
...
public class Posts extends BaseTimeEntity {
...
```

- JPA Auditing : Spring Data JPAì—ì„œ ì‹œê°„ì— ëŒ€í•´ ìë™ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ì— ê°’ì„ ë„£ì–´ì£¼ëŠ” ê¸°ëŠ¥

- @MappedSuperclass : JPA Entity í´ë˜ìŠ¤ë“¤ì´ í•´ë‹¹ ì¶”ìƒ í´ë˜ìŠ¤ë¥¼ ìƒì†í•  ê²½ìš° CreatedDateì™€ ModifiedDateë¥¼ ì»¬ëŸ¼ìœ¼ë¡œ ì¸ì‹

- @EntityListeners(AuditingEntityListener.class) : í•´ë‹¹ í´ë˜ìŠ¤ì— Auditing ê¸°ëŠ¥ í¬í•¨

<br>
<br>

Application í´ë˜ìŠ¤ì—ë„ JPA Auditing ì–´ë…¸í…Œì´ì…˜ì„ í™œì„±í™” í•  ìˆ˜ ìˆëŠ” `@EnableJpaAuditing` ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ì£¼ì.

```java
package com.test.spring.boot_crud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.data.jpa.repository.config.EnableJpaAuditing;

@EnableJpaAuditing
@SpringBootApplication
public class BootCrudApplication {

	public static void main(String[] args) {
		SpringApplication.run(BootCrudApplication.class, args);
	}

}
```

<br>
<br>

## <span style="color:#809A6F">ğŸ‹ index í™”ë©´ ìˆ˜ì •</span>
<hr>

index í™”ë©´ì„ ìˆ˜ì • í•´ ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¶œë ¥í•´ë³´ì.

src/main/resources/templates/index.mustache

```html
{{>layout/header}}

<h1>ìŠ¤í”„ë§ ë¶€íŠ¸ + JPA ê²Œì‹œíŒ ë§Œë“¤ê¸°</h1>

<a href="/posts/save" class="btn btn-info">ê¸€ ë“±ë¡</a>

<table class="table table-horizontal table-bordered">
    <thead class="thead-strong">
    <tr>
        <th>ê²Œì‹œê¸€ë²ˆí˜¸</th>
        <th>ì œëª©</th>
        <th>ì‘ì„±ì</th>
        <th>ìµœì¢…ìˆ˜ì •ì¼</th>
    </tr>
    </thead>
    <tbody id="tbody">
    {{#posts}}
        <tr>
            <td>{{id}}</td>
            <td>{{title}}</td>
            <td>{{author}}</td>
            <td>{{modifiedDate}}</td>
        </tr>
    {{/posts}}
    </tbody>
</table>

{{>layout/footer}}
```

ìœ„ ì½”ë“œëŠ” ì•„ë˜ì—ì„œ ìˆ˜ì •í•  ì˜ˆì • ã….ã…

<br>
<br>

## <span style="color:#809A6F">ğŸ‹ Repository</span>
<hr>

src/main/java/com/test/spring/boot_crud/domain/posts/PostsRepository.java

```java
package com.test.spring.boot_crud.domain.posts;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;

import java.util.List;

public interface PostsRepository extends JpaRepository<Posts, Long> {

    @Query("SELECT p FROM Posts p ORDER BY p.id DESC")
    List<Posts> findAllDesc();
}
```

- @Query : JPAê°€ ìë™ ìƒì„±í•˜ëŠ” ì¿¼ë¦¬ê°€ ì•„ë‹Œ ì‚¬ìš©ìê°€ ì •ì˜í•˜ëŠ” ì¿¼ë¦¬ ìƒì„± ë˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì¢…ì†ì ì¸ Native Query ìƒì„±ì„ ìœ„í•´ ì‚¬ìš©

<br>
<br>

## <span style="color:#809A6F">ğŸ‹ Service</span>
<hr>

src/main/java/com/test/spring/boot_crud/service/PostsService.java

```java
package com.test.spring.boot_crud.service.posts;

import com.test.spring.boot_crud.domain.posts.PostsRepository;
import com.test.spring.boot_crud.web.dto.PostsListResponseDto;
import com.test.spring.boot_crud.web.dto.PostsSaveRequestDto;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.stream.Collectors;

@RequiredArgsConstructor
@Service
public class PostsService {

    ...

    @Transactional(readOnly = true)
    public List<PostsListResponseDto> findAllDesc(){
        return postsRepository.findAllDesc().stream()
                .map(PostsListResponseDto::new)
                .collect(Collectors.toList());
    }
}
```

- .map(PostsListResponseDto::new) : .map(posts -> new PostListResponseDto(posts))

<br>
<br>

## <span style="color:#809A6F">ğŸ‹ Dto</span>
<hr>

src/main/java/com/test/spring/boot_crud/web/dto/PostsListResponseDto.java

```java
package com.test.spring.boot_crud.web.dto;

import com.test.spring.boot_crud.domain.posts.Posts;
import lombok.Getter;

import java.time.LocalDateTime;

@Getter
public class PostsListResponseDto {

    private Long id;
    private String title;
    private String author;
    private LocalDateTime modifiedDate;

    public PostsListResponseDto(Posts entity) {
        this.id = entity.getId();
        this.title = entity.getTitle();
        this.author = entity.getAuthor();
        this.modifiedDate = entity.getModifiedDate;
    }
}
```

<br>
<br>

## <span style="color:#809A6F">ğŸ‹ Controller</span>
<hr>

src/main/java/com/test/spring/boot_crud/web/IndexController.java

```java
package com.test.spring.boot_crud.web;

import com.test.spring.boot_crud.service.posts.PostsService;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@RequiredArgsConstructor
@Controller
public class IndexController {

    private final PostsService postsService;

    @GetMapping("/")
    public String index(Model model) {
        model.addAttribute("posts", postsService.findAllDesc());
        return "index";
    }

    @GetMapping("/posts/save")
    public String postsSave(){
        return "posts-save";
    }

}
```

<br>
<br>

## <span style="color:#809A6F">ğŸ‹Mustache - No key, method or field with name ì—ëŸ¬</span>
<hr>

ì‹¤í–‰í–ˆë”ë‹ˆ ì§€ê²¨ìš´ 500 ì—ëŸ¬ê°€ ë–´ë‹¤.

![](/assets/img/boot_jpa_error_3.PNG)

![](/assets/img/boot_jpa_error_4.PNG)

Mustacheì—ì„œ Key ê°’ì´ Nullì´ê±°ë‚˜ emptyì¸ ê²½ìš° ìœ„ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ê³  í•œë‹¤.

ì²˜ìŒ ë“±ë¡í•œ ê¸€ì˜ modifiedDate ê°’ì´ ì—†ì–´ì„œ ì—ëŸ¬ê°€ ë‚¬ë‚˜ë³´ë‹¤.

index.mustacheë¡œ ê°€ì„œ

```html
<td>{{modifiedDate}}</td>
```

ì´ ë¶€ë¶„ì„

```html
<td>
    {{#modifiedDate}}{{modifiedDate}}{{/modifiedDate}}
    {{^modifiedDate}}N{{/modifiedDate}}
</td>
```

ì´ë ‡ê²Œ ìˆ˜ì •í•˜ì.

ê°’ì´ ìˆë‹¤ë©´ ìœ„ì˜ `{{}}` ì•ˆ ê°’ì„ ì¶œë ¥, nullì´ê±°ë‚˜ emptyì¸ ê²½ìš° ê°€ìš´ë°(N ìë¦¬) ê°’ì„ ì¶œë ¥í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.

ìˆ˜ì • í›„ ë‹¤ì‹œ ì‹¤í–‰ ã„±ã„±, ìƒˆë¡œìš´ ê¸€ì„ ë“±ë¡í•´ë³´ì.

![](/assets/img/boot_jpa_list.PNG)

ìœ„ì—ì„œ ì„¤ì •í•œëŒ€ë¡œ ì²˜ìŒ ì‘ì„±í•œ ê¸€ì—ëŠ” Nì´, ë‘ ë²ˆì§¸ë¡œ ì‘ì„±í•œ ê¸€ì—ëŠ” modifiedDateê°€ ëœ¨ëŠ” ê±¸ ë³¼ ìˆ˜ ìˆë‹¤.

![](/assets/img/boot_jpa_list_mysql.PNG)
